package ers

author  Serguei.Kolos@cern.ch
manager	Serguei.Kolos@cern.ch

use TDAQCPolicy
use Boost	*	TDAQCExternal
use Python	*	TDAQCExternal

private

macro boost_libs "-lboost_thread-$(boost_libsuffix) -lboost_date_time-$(boost_libsuffix)"
########################################################################################################
#       ERS Libraries
########################################################################################################
library		ers				$(lib_opts)	"*.cxx"
macro           ers_shlibflags          	$(boost_libs)

library		erspy				$(lib_opts)	"../python/*.cxx"
macro           erspy_shlibflags          	"-lers -lboost_python-$(boost_libsuffix)" 
macro           erspy_dependencies		"ers" 


library		ErsBaseStreams			$(lib_opts)	"streams/*.cxx"
macro           ErsBaseStreams_shlibflags	" -lers $(boost_libs) -lboost_regex-$(boost_libsuffix)" 
macro		ErsBaseStreams_dependencies	"ers" 
		
apply_pattern   install_libs            	files="libers.so libErsBaseStreams.so liberspy.so"

########################################################################################################
#       Test applications
########################################################################################################
application	ers_test 			"../test/test.cxx"
application	ers_psc				"../bin/config.cxx"
application	ers_receiver 			"../test/receiver.cxx"

macro		ers_test_dependencies		"ers" 
macro		ers_testlinkopts		"-lers $(boost_libs)"

macro		ers_receiver_dependencies	"ers" 
macro		ers_receiverlinkopts		"-lers $(boost_libs)"

macro		ers_psc_dependencies		"ers" 
macro		ers_psclinkopts			"-lers $(boost_libs)"

########################################################################################################
#       Installation patterns
########################################################################################################
apply_pattern   install_apps            files="ers_psc ers_receiver ers_test"

apply_pattern   install_headers         name="internal"         src_dir="../ers/internal"\
                                                                files="*.h" \
                                                                target_dir="internal"
                                                                
apply_pattern   install_headers         name="thread"		src_dir="../ers/thread"\
                                                                files="*.h" \
                                                                target_dir="thread"

apply_pattern	install_data		name="python" 		src_dir="../python" \
								target_dir="../../lib/python" \
								files="ers.py"

########################################################################################################
#       Check target
########################################################################################################
action 		check "../check_target.sh $(bin)"
